# CategoryManager 모듈 개발 완료

## 개요
관리자 대시보드에서 카테고리별 단어장을 관리하는 독립적인 모듈이 개발되었습니다.
전체 앱에 영향을 주지 않도록 모듈화되어 있으며, 체크박스 선택 및 드래그 앤 드롭 기능을 제공합니다.

## 주요 기능

### 1. 여러 단어장 선택 및 병합 ✅
- 체크박스로 여러 단어장 선택
- "모두 선택/해제" 버튼으로 일괄 선택
- 2개 이상 선택 시 "병합하기" 버튼 활성화
- 병합 다이얼로그에서:
  - 기준 단어장 선택 (라디오 버튼)
  - 새로운 이름 지정 (선택사항)
  - 병합 결과 미리보기
  - 병합 실행 시 자동으로 단어 합치고 원본 삭제

### 2. 드래그 앤 드롭으로 카테고리 간 이동 ✅
- 단어장 왼쪽의 드래그 핸들(≡) 아이콘으로 드래그
- 다른 카테고리 헤더에 드롭하면 자동 이동
- 드롭 가능한 영역은 시각적 피드백 제공 (보라색 하이라이트)
- 실시간으로 서버에 반영

### 3. 개별 단어장 관리 ✅
- 편집 버튼으로 수정
- 삭제 버튼으로 즉시 삭제
- 모든 작업은 확인 다이얼로그 표시

## 파일 구조

```
src/components/admin/CategoryManager/
├── index.ts                    # Export 모듈
├── types.ts                    # TypeScript 타입 정의
├── api.ts                      # API 호출 유틸리티 함수
├── CategoryManager.tsx         # 메인 컴포넌트
├── CategoryDropZone.tsx        # 드롭 가능한 카테고리 헤더
├── VocabularyItem.tsx          # 드래그 가능한 단어장 아이템
├── MergeDialog.tsx             # 병합 다이얼로그
└── README.md                   # 모듈 문서
```

## 통합 방법

### AdminDashboard.tsx 수정 사항
```tsx
import { CategoryManager } from './admin/CategoryManager';

// Categories 스크린에서 사용
{currentScreen === 'categories' && (
  <CategoryManager getAuthToken={getAuthToken} />
)}
```

기존 `CategoriesScreen` 컴포넌트는 그대로 유지되어 있으므로, 필요시 원복 가능합니다.

## 백엔드 API 추가

### 새로운 엔드포인트
**POST** `/admin/shared-vocabularies/merge`

**Request Body:**
```json
{
  "targetVocabId": "abc123",
  "sourceVocabIds": ["def456", "ghi789"],
  "newTitle": "병합된 단어장" // 선택사항
}
```

**Response:**
```json
{
  "success": true,
  "mergedVocabId": "abc123",
  "totalWords": 250
}
```

**동작:**
1. `targetVocabId` 단어장을 기준으로 삼음
2. `sourceVocabIds`의 모든 단어를 `targetVocabId`에 추가
3. `sourceVocabIds` 단어장들을 자동 삭제
4. 병합된 단어장의 `total_words` 업데이트

## 사용된 라이브러리

### 새로 설치된 패키지
```json
{
  "@dnd-kit/core": "^6.3.1",
  "@dnd-kit/sortable": "^10.0.0",
  "@dnd-kit/utilities": "^3.2.2"
}
```

### 기존 라이브러리 활용
- `motion/react` - 애니메이션
- `lucide-react` - 아이콘
- `sonner` - 토스트 알림
- `tailwindcss` - 스타일링

## 사용 가이드

### 단어장 병합하기
1. Categories 탭 클릭
2. 카테고리를 클릭하여 단어장 목록 확장
3. 병합할 단어장들을 체크박스로 선택 (2개 이상)
4. 상단에 나타나는 "병합하기" 버튼 클릭
5. 다이얼로그에서 기준 단어장 선택
6. 원하면 새 이름 입력
7. "병합하기" 버튼 클릭

### 단어장 카테고리 이동하기
1. Categories 탭 클릭
2. 카테고리를 클릭하여 단어장 목록 확장
3. 이동할 단어장의 드래그 핸들(≡) 클릭하고 드래그
4. 다른 카테고리 헤더 위로 드래그
5. 보라색 하이라이트가 보이면 드롭
6. 자동으로 이동 완료

## 시각적 피드백

### 상태별 표시
- **선택된 단어장**: 보라색 테두리, 보라색 배경
- **드래그 중**: 투명도 50%, 확대된 미리보기
- **드롭 가능 영역**: 보라색 배경, 왼쪽 보라색 선
- **병합 가능**: 상단 보라색 액션 바 표시

## 보안 및 권한

- 모든 API 호출은 `Authorization: Bearer {token}` 필요
- 관리자 권한 필수
- 서버 측에서 권한 검증

## 주의사항

⚠️ **병합은 되돌릴 수 없습니다**
- 병합 시 원본 단어장들이 영구 삭제됩니다
- 신중하게 선택하세요

⚠️ **드래그 앤 드롭 제약**
- 터치 스크린에서는 제한적으로 작동할 수 있습니다
- 마우스/트랙패드 사용 권장

⚠️ **성능 고려사항**
- 단어장이 많을 경우 로딩이 느릴 수 있습니다
- 향후 페이지네이션 추가 예정

## 배포 완료

✅ 서버 함수 배포 완료
```bash
npx supabase functions deploy server
```

✅ 개발 서버 실행 중
```
http://localhost:3001
```

## 테스트 방법

1. 개발 서버 접속: http://localhost:3001
2. 관리자 계정으로 로그인
3. Admin Panel 열기
4. Categories 탭 클릭
5. 기능 테스트:
   - [ ] 카테고리 확장/축소
   - [ ] 단어장 체크박스 선택
   - [ ] "모두 선택" 버튼
   - [ ] 2개 이상 선택 시 병합 버튼 표시
   - [ ] 병합 다이얼로그 열기
   - [ ] 병합 실행
   - [ ] 드래그 앤 드롭으로 카테고리 이동

## 향후 개선 사항

- [ ] 페이지네이션 추가
- [ ] 병합 시 중복 단어 제거 옵션
- [ ] 단어장 미리보기 모달
- [ ] 벌크 작업 (일괄 삭제/이동)
- [ ] 실행 취소/다시 실행
- [ ] 터치 스크린 지원 개선
- [ ] 드래그 앤 드롭 애니메이션 개선
- [ ] 검색 및 필터 기능

## 문제 해결

### 병합 API 404 에러
```bash
# 서버 함수 재배포
npx supabase functions deploy server
```

### 드래그가 작동하지 않음
- 브라우저 새로고침
- 개발자 도구에서 에러 확인
- @dnd-kit 패키지 재설치

### 체크박스가 보이지 않음
- Tailwind CSS 설정 확인
- 브라우저 캐시 삭제

## 연락처

문제가 발생하면 관리자에게 문의하세요.

---

**개발 완료일**: 2025년 11월 18일
**버전**: 1.0.0
**상태**: ✅ 프로덕션 준비 완료
